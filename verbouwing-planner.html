<!DOCTYPE html>
<html lang="nl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Verbouwing Planner</title>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            margin: 0;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Oxygen', 'Ubuntu', 'Cantarell', 'Fira Sans', 'Droid Sans', 'Helvetica Neue', sans-serif;
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useMemo, useEffect } = React;

        // Lucide Icons als SVG componenten
        const Home = () => (
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                <path d="m3 9 9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path>
                <polyline points="9 22 9 12 15 12 15 22"></polyline>
            </svg>
        );

        const Package = () => (
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                <path d="m7.5 4.27 9 5.15"></path>
                <path d="M21 8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16Z"></path>
                <path d="m3.3 7 8.7 5 8.7-5"></path>
                <path d="M12 22V12"></path>
            </svg>
        );

        const FileText = () => (
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                <path d="M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z"></path>
                <polyline points="14 2 14 8 20 8"></polyline>
                <line x1="16" x2="8" y1="13" y2="13"></line>
                <line x1="16" x2="8" y1="17" y2="17"></line>
                <line x1="10" x2="8" y1="9" y2="9"></line>
            </svg>
        );

        const CheckSquare = () => (
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                <polyline points="9 11 12 14 22 4"></polyline>
                <path d="M21 12v7a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11"></path>
            </svg>
        );

        const DollarSign = () => (
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                <line x1="12" x2="12" y1="2" y2="22"></line>
                <path d="M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"></path>
            </svg>
        );

        const Plus = () => (
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                <path d="M5 12h14"></path>
                <path d="M12 5v14"></path>
            </svg>
        );

        const X = () => (
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                <path d="M18 6 6 18"></path>
                <path d="m6 6 12 12"></path>
            </svg>
        );

        const Edit2 = () => (
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                <path d="M17 3a2.85 2.83 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5Z"></path>
                <path d="m15 5 4 4"></path>
            </svg>
        );

        const ExternalLink = () => (
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                <path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"></path>
                <polyline points="15 3 21 3 21 9"></polyline>
                <line x1="10" x2="21" y1="14" y2="3"></line>
            </svg>
        );

        const Download = () => (
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                <polyline points="7 10 12 15 17 10"></polyline>
                <line x1="12" x2="12" y1="15" y2="3"></line>
            </svg>
        );

        const Filter = () => (
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                <polygon points="22 3 2 3 10 12.46 10 19 14 21 14 12.46 22 3"></polygon>
            </svg>
        );

        const Upload = () => (
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                <polyline points="17 8 12 3 7 8"></polyline>
                <line x1="12" x2="12" y1="3" y2="15"></line>
            </svg>
        );

        const Calendar = () => (
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect>
                <line x1="16" y1="2" x2="16" y2="6"></line>
                <line x1="8" y1="2" x2="8" y2="6"></line>
                <line x1="3" y1="10" x2="21" y2="10"></line>
            </svg>
        );

        const VerbouwingPlanner = () => {
            // LocalStorage keys
            const STORAGE_KEYS = {
                producten: 'verbouwing_producten',
                offertes: 'verbouwing_offertes',
                taken: 'verbouwing_taken',
                budget: 'verbouwing_budget'
            };

            // Load data from localStorage
            const loadFromStorage = (key, defaultValue) => {
                try {
                    const item = localStorage.getItem(key);
                    return item ? JSON.parse(item) : defaultValue;
                } catch (error) {
                    console.error('Error loading from localStorage:', error);
                    return defaultValue;
                }
            };

            // State met localStorage
            const [producten, setProducten] = useState(() => {
                const loaded = loadFromStorage(STORAGE_KEYS.producten, [
                    { id: 1, naam: 'Keuken', categorie: 'Keuken', prijs: 8500, link: 'https://example.com/keuken', leverancier: 'Keuken Inc', notities: 'Inclusief montage', gekocht: false, budgetCategorie: 'Keuken', type: 'Te kopen' },
                    { id: 2, naam: 'Badkamer tegels', categorie: 'Badkamer', prijs: 1200, link: '', leverancier: 'Tegel Paleis', notities: '20mÂ²', gekocht: false, budgetCategorie: 'Badkamer', type: 'Te kopen' }
                ]);
                // Zorg dat alle producten een type hebben (backwards compatibility)
                return loaded.map(p => ({
                    ...p,
                    type: p.type || 'Te kopen'
                }));
            });

            const [offertes, setOffertes] = useState(() =>
                loadFromStorage(STORAGE_KEYS.offertes, [
                    { id: 1, leverancier: 'Bouwbedrijf Jansen', werk: 'Metselwerk', bedrag: 15000, datum: '2025-10-15', status: 'Ontvangen', notities: 'Inclusief materiaal', budgetCategorie: 'Bouw' },
                    { id: 2, leverancier: 'Elektra Pro', werk: 'Elektra', bedrag: 4500, datum: '2025-10-12', status: 'Geaccepteerd', notities: 'Start week 44', budgetCategorie: 'Elektra' }
                ])
            );

            const [taken, setTaken] = useState(() => {
                const loaded = loadFromStorage(STORAGE_KEYS.taken, [
                    { id: 1, taak: 'Sloopvergunning aanvragen', toegewezenAan: 'Jan', prioriteit: 'Hoog', status: 'In uitvoering', categorie: 'Diensten', startDatum: '2025-10-20', eindDatum: '2025-10-25', notities: '' },
                    { id: 2, taak: 'Kleurstalen ophalen', toegewezenAan: 'Marie', prioriteit: 'Medium', status: 'Te doen', categorie: 'Producten', startDatum: '2025-10-28', eindDatum: '2025-11-01', notities: 'Bij de verfwinkel' },
                    { id: 3, taak: 'Keuken plaatsen', toegewezenAan: 'Jan', prioriteit: 'Hoog', status: 'Te doen', categorie: 'Diensten', startDatum: '2025-11-05', eindDatum: '2025-11-08', notities: 'Leverancier regelt montage' }
                ]);
                // Zorg dat alle taken de juiste velden hebben (voor backwards compatibility)
                return loaded.map(t => ({
                    ...t,
                    categorie: t.categorie || 'Overig',
                    startDatum: t.startDatum || t.deadline || new Date().toISOString().split('T')[0],
                    eindDatum: t.eindDatum || t.deadline || new Date().toISOString().split('T')[0],
                    notities: t.notities || ''
                }));
            });

            const [budgetItems, setBudgetItems] = useState(() =>
                loadFromStorage(STORAGE_KEYS.budget, [
                    { id: 1, categorie: 'Keuken', gepland: 12000, notities: 'Keukeninrichting' },
                    { id: 2, categorie: 'Badkamer', gepland: 8000, notities: 'Badkamerrenovatie' },
                    { id: 3, categorie: 'Elektra', gepland: 5000, notities: 'Elektra werkzaamheden' },
                    { id: 4, categorie: 'Bouw', gepland: 20000, notities: 'Bouwwerkzaamheden' }
                ])
            );

            // Save to localStorage whenever data changes
            useEffect(() => {
                localStorage.setItem(STORAGE_KEYS.producten, JSON.stringify(producten));
            }, [producten]);

            useEffect(() => {
                localStorage.setItem(STORAGE_KEYS.offertes, JSON.stringify(offertes));
            }, [offertes]);

            useEffect(() => {
                localStorage.setItem(STORAGE_KEYS.taken, JSON.stringify(taken));
            }, [taken]);

            useEffect(() => {
                localStorage.setItem(STORAGE_KEYS.budget, JSON.stringify(budgetItems));
            }, [budgetItems]);

            const [activeTab, setActiveTab] = useState('dashboard');
            const [showModal, setShowModal] = useState(false);
            const [modalType, setModalType] = useState('');
            const [editItem, setEditItem] = useState(null);
            const [filterCategorie, setFilterCategorie] = useState('Alle');
            const [filterStatus, setFilterStatus] = useState('Alle');
            const [filterTaakCategorie, setFilterTaakCategorie] = useState('Alle');
            const [filterPersoon, setFilterPersoon] = useState('Alle');
            const [filterTaakStatus, setFilterTaakStatus] = useState('Alle');

            const [formData, setFormData] = useState({});

            // Bereken budget per categorie
            const calculateBudgetDetails = useMemo(() => {
                return budgetItems.map(budget => {
                    // Bereken uitgegeven: gekochte producten (alleen 'Te kopen', niet Wishlist) + geaccepteerde offertes
                    const uitgegeven = [
                        ...producten.filter(p => p.gekocht && p.budgetCategorie === budget.categorie && p.type !== 'Wishlist').map(p => p.prijs),
                        ...offertes.filter(o => o.status === 'Geaccepteerd' && o.budgetCategorie === budget.categorie).map(o => o.bedrag)
                    ].reduce((sum, val) => sum + val, 0);

                    // Bereken nog te kopen: niet gekochte producten (alleen 'Te kopen', niet Wishlist) + ontvangen offertes
                    const nogTeKopen = [
                        ...producten.filter(p => !p.gekocht && p.budgetCategorie === budget.categorie && p.type !== 'Wishlist').map(p => p.prijs),
                        ...offertes.filter(o => o.status === 'Ontvangen' && o.budgetCategorie === budget.categorie).map(o => o.bedrag)
                    ].reduce((sum, val) => sum + val, 0);

                    const totaalVerwacht = uitgegeven + nogTeKopen;
                    const resterend = budget.gepland - totaalVerwacht;

                    return {
                        ...budget,
                        uitgegeven,
                        nogTeKopen,
                        totaalVerwacht,
                        resterend
                    };
                });
            }, [budgetItems, producten, offertes]);

            // Bereken statistieken
            const stats = useMemo(() => {
                const totaalGepland = budgetItems.reduce((sum, item) => sum + item.gepland, 0);
                const totaalUitgegeven = calculateBudgetDetails.reduce((sum, item) => sum + item.uitgegeven, 0);
                const totaalNogTeKopen = calculateBudgetDetails.reduce((sum, item) => sum + item.nogTeKopen, 0);
                const totaalVerwacht = totaalUitgegeven + totaalNogTeKopen;
                const takenCompleet = taken.filter(t => t.status === 'Voltooid').length;
                const takenTotaal = taken.length;
                const productenGekocht = producten.filter(p => p.gekocht).length;
                const productenTotaal = producten.length;
                
                return {
                    totaalGepland,
                    totaalUitgegeven,
                    totaalNogTeKopen,
                    totaalVerwacht,
                    resterendBudget: totaalGepland - totaalVerwacht,
                    takenProgress: takenTotaal > 0 ? (takenCompleet / takenTotaal * 100).toFixed(0) : 0,
                    productenProgress: productenTotaal > 0 ? (productenGekocht / productenTotaal * 100).toFixed(0) : 0,
                    offertesPending: offertes.filter(o => o.status === 'Ontvangen').length
                };
            }, [budgetItems, calculateBudgetDetails, taken, producten, offertes]);

            // CategorieÃ«n ophalen
            const categorieÃ«n = ['Alle', ...new Set(producten.map(p => p.categorie))];

            // Modal handlers
            const openModal = (type, item = null) => {
                setModalType(type);
                setEditItem(item);
                if (item) {
                    setFormData(item);
                } else {
                    setFormData({});
                }
                setShowModal(true);
            };

            const closeModal = () => {
                setShowModal(false);
                setEditItem(null);
                setFormData({});
            };

            const handleSubmit = (e) => {
                e.preventDefault();
                
                if (modalType === 'product') {
                    if (editItem) {
                        setProducten(producten.map(p => p.id === editItem.id ? { ...formData, id: editItem.id } : p));
                    } else {
                        setProducten([...producten, { ...formData, id: Date.now(), gekocht: false }]);
                    }
                } else if (modalType === 'offerte') {
                    if (editItem) {
                        setOffertes(offertes.map(o => o.id === editItem.id ? { ...formData, id: editItem.id } : o));
                    } else {
                        setOffertes([...offertes, { ...formData, id: Date.now() }]);
                    }
                } else if (modalType === 'taak') {
                    if (editItem) {
                        setTaken(taken.map(t => t.id === editItem.id ? { ...formData, id: editItem.id } : t));
                    } else {
                        setTaken([...taken, { ...formData, id: Date.now() }]);
                    }
                } else if (modalType === 'budget') {
                    if (editItem) {
                        setBudgetItems(budgetItems.map(b => b.id === editItem.id ? { ...formData, id: editItem.id } : b));
                    } else {
                        setBudgetItems([...budgetItems, { ...formData, id: Date.now() }]);
                    }
                }
                
                closeModal();
            };

            const handleDelete = (type, id) => {
                if (window.confirm('Weet je zeker dat je dit wilt verwijderen?')) {
                    if (type === 'product') setProducten(producten.filter(p => p.id !== id));
                    else if (type === 'offerte') setOffertes(offertes.filter(o => o.id !== id));
                    else if (type === 'taak') setTaken(taken.filter(t => t.id !== id));
                    else if (type === 'budget') setBudgetItems(budgetItems.filter(b => b.id !== id));
                }
            };

            const toggleProductGekocht = (id) => {
                setProducten(producten.map(p => p.id === id ? { ...p, gekocht: !p.gekocht } : p));
            };

            const exportData = () => {
                const data = {
                    producten,
                    offertes,
                    taken,
                    budget: budgetItems,
                    exportDatum: new Date().toISOString()
                };
                const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `verbouwing-data-${new Date().toISOString().split('T')[0]}.json`;
                a.click();
                URL.revokeObjectURL(url);
            };

            const importData = (event) => {
                const file = event.target.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onload = (e) => {
                        try {
                            const data = JSON.parse(e.target.result);
                            if (window.confirm('Weet je zeker dat je de huidige data wilt vervangen met de geÃ¯mporteerde data?')) {
                                if (data.producten) setProducten(data.producten);
                                if (data.offertes) setOffertes(data.offertes);
                                if (data.taken) setTaken(data.taken);
                                if (data.budget) setBudgetItems(data.budget);
                                alert('Data succesvol geÃ¯mporteerd!');
                            }
                        } catch (error) {
                            alert('Fout bij het importeren van data. Controleer of het bestand geldig is.');
                            console.error(error);
                        }
                    };
                    reader.readAsText(file);
                }
            };

            // Bereken unieke personen voor filter
            const uniekePersonen = [...new Set(taken.map(t => t.toegewezenAan).filter(Boolean))].sort();

            // Gefilterde producten
            const gefilterdeProducten = producten.filter(p => 
                (filterCategorie === 'Alle' || p.categorie === filterCategorie) &&
                (filterStatus === 'Alle' || (filterStatus === 'Gekocht' && p.gekocht) || (filterStatus === 'Nog kopen' && !p.gekocht))
            );

            return (
                <div className="min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 p-4">
                    <div className="max-w-7xl mx-auto">
                        {/* Header */}
                        <div className="bg-white rounded-lg shadow-lg p-6 mb-6">
                            <div className="flex items-center justify-between flex-wrap gap-4">
                                <div className="flex items-center gap-3">
                                    <div className="text-indigo-600"><Home /></div>
                                    <div>
                                        <h1 className="text-3xl font-bold text-gray-800">Verbouwing Planner</h1>
                                        <p className="text-gray-600">Organiseer jullie nieuwe huis</p>
                                    </div>
                                </div>
                                <div className="flex gap-2">
                                    <label className="flex items-center gap-2 bg-green-600 text-white px-4 py-2 rounded-lg hover:bg-green-700 transition cursor-pointer">
                                        <Upload />
                                        <span>Import</span>
                                        <input type="file" accept=".json" onChange={importData} className="hidden" />
                                    </label>
                                    <button
                                        onClick={exportData}
                                        className="flex items-center gap-2 bg-indigo-600 text-white px-4 py-2 rounded-lg hover:bg-indigo-700 transition"
                                    >
                                        <Download />
                                        Export
                                    </button>
                                </div>
                            </div>
                        </div>

                        {/* Tabs */}
                        <div className="bg-white rounded-lg shadow-lg mb-6">
                            <div className="flex border-b overflow-x-auto">
                                {[
                                    { id: 'dashboard', icon: Home, label: 'Dashboard' },
                                    { id: 'producten', icon: Package, label: 'Producten' },
                                    { id: 'offertes', icon: FileText, label: 'Offertes' },
                                    { id: 'taken', icon: CheckSquare, label: 'Taken' },
                                    { id: 'planning', icon: Calendar, label: 'Planning' },
                                    { id: 'budget', icon: DollarSign, label: 'Budget' }
                                ].map(tab => (
                                    <button
                                        key={tab.id}
                                        onClick={() => setActiveTab(tab.id)}
                                        className={`flex items-center gap-2 px-6 py-4 font-medium transition ${
                                            activeTab === tab.id
                                                ? 'border-b-2 border-indigo-600 text-indigo-600'
                                                : 'text-gray-600 hover:text-indigo-600'
                                        }`}
                                    >
                                        <tab.icon />
                                        {tab.label}
                                    </button>
                                ))}
                            </div>

                            <div className="p-6">
                                {/* Dashboard Tab */}
                                {activeTab === 'dashboard' && (
                                    <div>
                                        <h2 className="text-2xl font-bold text-gray-800 mb-6">Overzicht</h2>
                                        
                                        <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 mb-8">
                                            <div className="bg-gradient-to-br from-green-50 to-green-100 p-6 rounded-lg border-2 border-green-200">
                                                <div className="flex items-center justify-between mb-2">
                                                    <span className="text-green-700 font-medium">Budget Status</span>
                                                    <div className="text-green-600"><DollarSign /></div>
                                                </div>
                                                <div className="text-3xl font-bold text-green-800">â‚¬{stats.totaalUitgegeven.toLocaleString('nl-NL')}</div>
                                                <div className="text-sm text-green-600 mt-1">uitgegeven van â‚¬{stats.totaalGepland.toLocaleString('nl-NL')} gepland</div>
                                                <div className="text-sm text-orange-700 mt-1 font-medium">â‚¬{stats.totaalNogTeKopen.toLocaleString('nl-NL')} nog te kopen</div>
                                                <div className="text-sm text-green-700 mt-1 font-medium">â‚¬{stats.resterendBudget.toLocaleString('nl-NL')} beschikbaar</div>
                                            </div>

                                            <div className="bg-gradient-to-br from-blue-50 to-blue-100 p-6 rounded-lg border-2 border-blue-200">
                                                <div className="flex items-center justify-between mb-2">
                                                    <span className="text-blue-700 font-medium">Taken Voortgang</span>
                                                    <div className="text-blue-600"><CheckSquare /></div>
                                                </div>
                                                <div className="text-3xl font-bold text-blue-800">{stats.takenProgress}%</div>
                                                <div className="text-sm text-blue-600 mt-1">{taken.filter(t => t.status === 'Voltooid').length} van {taken.length} voltooid</div>
                                                <div className="w-full bg-blue-200 rounded-full h-2 mt-3">
                                                    <div className="bg-blue-600 h-2 rounded-full transition-all" style={{ width: `${stats.takenProgress}%` }}></div>
                                                </div>
                                            </div>

                                            <div className="bg-gradient-to-br from-purple-50 to-purple-100 p-6 rounded-lg border-2 border-purple-200">
                                                <div className="flex items-center justify-between mb-2">
                                                    <span className="text-purple-700 font-medium">Producten</span>
                                                    <div className="text-purple-600"><Package /></div>
                                                </div>
                                                <div className="text-3xl font-bold text-purple-800">{stats.productenProgress}%</div>
                                                <div className="text-sm text-purple-600 mt-1">{producten.filter(p => p.gekocht).length} van {producten.length} gekocht</div>
                                                <div className="w-full bg-purple-200 rounded-full h-2 mt-3">
                                                    <div className="bg-purple-600 h-2 rounded-full transition-all" style={{ width: `${stats.productenProgress}%` }}></div>
                                                </div>
                                            </div>
                                        </div>

                                        <div className="grid grid-cols-1 lg:grid-cols-2 gap-6">
                                            <div className="bg-white border-2 border-gray-200 rounded-lg p-6">
                                                <h3 className="text-lg font-bold text-gray-800 mb-4">Openstaande Taken (gesorteerd op deadline)</h3>
                                                <div className="space-y-3">
                                                    {taken
                                                        .filter(t => t.status !== 'Voltooid')
                                                        .sort((a, b) => new Date(a.eindDatum) - new Date(b.eindDatum))
                                                        .slice(0, 5)
                                                        .map(taak => {
                                                            const vandaag = new Date();
                                                            vandaag.setHours(0, 0, 0, 0);
                                                            const deadline = new Date(taak.eindDatum);
                                                            const dagenTot = Math.ceil((deadline - vandaag) / (1000 * 60 * 60 * 24));
                                                            const isVerlopen = deadline < vandaag;
                                                            const isSpoed = dagenTot <= 3 && dagenTot >= 0;
                                                            
                                                            return (
                                                                <div 
                                                                    key={taak.id} 
                                                                    className={`flex items-start justify-between p-3 rounded-lg cursor-pointer hover:shadow-md transition ${
                                                                        isVerlopen ? 'bg-red-50 border-2 border-red-200 hover:bg-red-100' :
                                                                        isSpoed ? 'bg-orange-50 border-2 border-orange-200 hover:bg-orange-100' :
                                                                        'bg-gray-50 hover:bg-gray-100'
                                                                    }`}
                                                                    onClick={() => openModal('taak', taak)}
                                                                >
                                                                    <div className="flex-1">
                                                                        <div className="flex items-center gap-2 mb-1">
                                                                            <div className="font-medium text-gray-800">{taak.taak}</div>
                                                                            {isVerlopen && (
                                                                                <span className="px-2 py-0.5 text-xs rounded bg-red-600 text-white font-bold">
                                                                                    VERLOPEN
                                                                                </span>
                                                                            )}
                                                                            {isSpoed && (
                                                                                <span className="px-2 py-0.5 text-xs rounded bg-orange-600 text-white font-bold">
                                                                                    URGENT
                                                                                </span>
                                                                            )}
                                                                        </div>
                                                                        <div className="text-sm text-gray-600">
                                                                            <span className="font-medium">{taak.toegewezenAan}</span> â€¢ 
                                                                            Deadline: {taak.eindDatum}
                                                                            {!isVerlopen && (
                                                                                <span className={`ml-1 ${isSpoed ? 'text-orange-700 font-bold' : 'text-gray-500'}`}>
                                                                                    ({dagenTot > 0 ? `over ${dagenTot} ${dagenTot === 1 ? 'dag' : 'dagen'}` : 'VANDAAG'})
                                                                                </span>
                                                                            )}
                                                                        </div>
                                                                    </div>
                                                                    <div className="flex items-center gap-2">
                                                                        <span className={`px-2 py-1 text-xs rounded-full whitespace-nowrap ${
                                                                            taak.prioriteit === 'Hoog' ? 'bg-red-100 text-red-700' :
                                                                            taak.prioriteit === 'Medium' ? 'bg-yellow-100 text-yellow-700' :
                                                                            'bg-green-100 text-green-700'
                                                                        }`}>
                                                                            {taak.prioriteit}
                                                                        </span>
                                                                        <Edit2 className="w-4 h-4 text-gray-400" />
                                                                    </div>
                                                                </div>
                                                            );
                                                        })
                                                    }
                                                    {taken.filter(t => t.status !== 'Voltooid').length === 0 && (
                                                        <p className="text-gray-500 text-center py-4">Geen openstaande taken</p>
                                                    )}
                                                </div>
                                            </div>

                                            <div className="bg-white border-2 border-gray-200 rounded-lg p-6">
                                                <h3 className="text-lg font-bold text-gray-800 mb-4">Recente Offertes</h3>
                                                <div className="space-y-3">
                                                    {offertes.slice(0, 5).map(offerte => (
                                                        <div key={offerte.id} className="flex items-start justify-between p-3 bg-gray-50 rounded-lg">
                                                            <div className="flex-1">
                                                                <div className="font-medium text-gray-800">{offerte.leverancier}</div>
                                                                <div className="text-sm text-gray-600 mt-1">{offerte.werk}</div>
                                                            </div>
                                                            <div className="text-right ml-2">
                                                                <div className="font-bold text-gray-800">â‚¬{offerte.bedrag.toLocaleString('nl-NL')}</div>
                                                                <span className={`text-xs px-2 py-1 rounded-full whitespace-nowrap ${
                                                                    offerte.status === 'Geaccepteerd' ? 'bg-green-100 text-green-700' :
                                                                    offerte.status === 'Afgewezen' ? 'bg-red-100 text-red-700' :
                                                                    'bg-yellow-100 text-yellow-700'
                                                                }`}>
                                                                    {offerte.status}
                                                                </span>
                                                            </div>
                                                        </div>
                                                    ))}
                                                    {offertes.length === 0 && (
                                                        <p className="text-gray-500 text-center py-4">Nog geen offertes</p>
                                                    )}
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                )}

                                {/* Producten Tab */}
                                {activeTab === 'producten' && (
                                    <div>
                                        <div className="flex items-center justify-between mb-6 flex-wrap gap-4">
                                            <h2 className="text-2xl font-bold text-gray-800">Producten</h2>
                                            <button
                                                onClick={() => openModal('product')}
                                                className="flex items-center gap-2 bg-indigo-600 text-white px-4 py-2 rounded-lg hover:bg-indigo-700 transition"
                                            >
                                                <Plus />
                                                Product toevoegen
                                            </button>
                                        </div>

                                        <div className="flex gap-4 mb-6 flex-wrap">
                                            <div className="flex items-center gap-2">
                                                <Filter />
                                                <select
                                                    value={filterCategorie}
                                                    onChange={(e) => setFilterCategorie(e.target.value)}
                                                    className="px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent"
                                                >
                                                    {categorieÃ«n.map(cat => (
                                                        <option key={cat} value={cat}>{cat}</option>
                                                    ))}
                                                </select>
                                            </div>
                                            <select
                                                value={filterStatus}
                                                onChange={(e) => setFilterStatus(e.target.value)}
                                                className="px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent"
                                            >
                                                <option value="Alle">Alle statussen</option>
                                                <option value="Gekocht">Gekocht</option>
                                                <option value="Nog kopen">Nog kopen</option>
                                            </select>
                                        </div>

                                        <div className="space-y-4">
                                            {gefilterdeProducten.map(product => (
                                                <div key={product.id} className="bg-white border-2 border-gray-200 rounded-lg p-4 hover:shadow-md transition">
                                                    <div className="flex gap-4">
                                                        {/* Foto */}
                                                        <div className="flex-shrink-0">
                                                            {product.afbeelding ? (
                                                                <img 
                                                                    src={product.afbeelding} 
                                                                    alt={product.naam}
                                                                    className="w-24 h-24 object-cover rounded-lg border-2 border-gray-200 cursor-pointer hover:scale-105 transition"
                                                                    onClick={() => {
                                                                        const modal = document.createElement('div');
                                                                        modal.className = 'fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-50 p-4';
                                                                        modal.onclick = () => modal.remove();
                                                                        modal.innerHTML = `<img src="${product.afbeelding}" class="max-w-full max-h-full rounded-lg" />`;
                                                                        document.body.appendChild(modal);
                                                                    }}
                                                                />
                                                            ) : (
                                                                <div className="w-24 h-24 bg-gray-100 rounded-lg flex items-center justify-center text-gray-400 text-xs border-2 border-gray-200">
                                                                    <Package />
                                                                </div>
                                                            )}
                                                        </div>

                                                        {/* Hoofd info */}
                                                        <div className="flex-1 min-w-0">
                                                            <div className="flex items-start justify-between gap-3 mb-2">
                                                                <div className="flex-1 min-w-0">
                                                                    <h3 className="font-bold text-gray-800 text-lg truncate">{product.naam}</h3>
                                                                    <div className="flex items-center gap-2 mt-1 flex-wrap">
                                                                        <span className="px-2 py-1 bg-indigo-100 text-indigo-700 text-xs rounded-full">
                                                                            {product.categorie}
                                                                        </span>
                                                                        <span className={`px-2 py-1 text-xs rounded-full font-medium ${
                                                                            product.type === 'Wishlist' 
                                                                                ? 'bg-pink-100 text-pink-700' 
                                                                                : 'bg-green-100 text-green-700'
                                                                        }`}>
                                                                            {product.type === 'Wishlist' ? 'ðŸ’­ Wishlist' : 'ðŸ›’ Te kopen'}
                                                                        </span>
                                                                        <span className="px-2 py-1 bg-purple-100 text-purple-700 text-xs rounded-full">
                                                                            {product.budgetCategorie || 'Geen budget'}
                                                                        </span>
                                                                        <span className={`px-3 py-1 text-xs rounded-full font-medium ${
                                                                            product.gekocht 
                                                                                ? 'bg-green-100 text-green-700' 
                                                                                : 'bg-yellow-100 text-yellow-700'
                                                                        }`}>
                                                                            {product.gekocht ? 'âœ“ Gekocht' : 'Nog kopen'}
                                                                        </span>
                                                                    </div>
                                                                </div>
                                                                
                                                                {/* Checkbox */}
                                                                <div className="flex items-center gap-2">
                                                                    <input
                                                                        type="checkbox"
                                                                        checked={product.gekocht}
                                                                        onChange={() => toggleProductGekocht(product.id)}
                                                                        className="w-6 h-6 text-green-600 rounded focus:ring-2 focus:ring-green-500 cursor-pointer"
                                                                        title={product.gekocht ? "Markeer als nog te kopen" : "Markeer als gekocht"}
                                                                    />
                                                                </div>
                                                            </div>

                                                            {/* Details grid */}
                                                            <div className="grid grid-cols-2 md:grid-cols-4 gap-3 mt-3 text-sm">
                                                                <div>
                                                                    <div className="text-gray-500 text-xs">Prijs</div>
                                                                    <div className="font-bold text-gray-800 text-lg">â‚¬{product.prijs.toLocaleString('nl-NL')}</div>
                                                                </div>
                                                                <div>
                                                                    <div className="text-gray-500 text-xs">Leverancier</div>
                                                                    <div className="text-gray-700 truncate">{product.leverancier || '-'}</div>
                                                                </div>
                                                                <div>
                                                                    <div className="text-gray-500 text-xs">Link</div>
                                                                    {product.link ? (
                                                                        <a
                                                                            href={product.link}
                                                                            target="_blank"
                                                                            rel="noopener noreferrer"
                                                                            className="text-indigo-600 hover:text-indigo-800 flex items-center gap-1"
                                                                        >
                                                                            <ExternalLink className="w-4 h-4" />
                                                                            <span className="text-xs">Webshop</span>
                                                                        </a>
                                                                    ) : (
                                                                        <span className="text-gray-400">-</span>
                                                                    )}
                                                                </div>
                                                                <div className="flex items-end justify-end gap-2">
                                                                    <button
                                                                        onClick={() => openModal('product', product)}
                                                                        className="text-blue-600 hover:text-blue-800 p-2 hover:bg-blue-50 rounded transition"
                                                                        title="Bewerken"
                                                                    >
                                                                        <Edit2 className="w-5 h-5" />
                                                                    </button>
                                                                    <button
                                                                        onClick={() => handleDelete('product', product.id)}
                                                                        className="text-red-600 hover:text-red-800 p-2 hover:bg-red-50 rounded transition"
                                                                        title="Verwijderen"
                                                                    >
                                                                        <X className="w-5 h-5" />
                                                                    </button>
                                                                </div>
                                                            </div>

                                                            {/* Notities */}
                                                            {product.notities && (
                                                                <div className="mt-3 p-2 bg-gray-50 rounded text-sm text-gray-600 italic">
                                                                    {product.notities}
                                                                </div>
                                                            )}
                                                        </div>
                                                    </div>
                                                </div>
                                            ))}

                                            {gefilterdeProducten.length === 0 && (
                                                <p className="text-gray-500 text-center py-8">Geen producten gevonden</p>
                                            )}
                                        </div>

                                        <div className="mt-6 p-4 bg-indigo-50 rounded-lg border border-indigo-200">
                                            <div className="flex items-center justify-between">
                                                <span className="text-indigo-800 font-medium">Totaal producten:</span>
                                                <span className="text-2xl font-bold text-indigo-600">
                                                    â‚¬{gefilterdeProducten.reduce((sum, p) => sum + p.prijs, 0).toLocaleString('nl-NL')}
                                                </span>
                                            </div>
                                        </div>
                                    </div>
                                )}

                                {/* Offertes Tab */}
                                {activeTab === 'offertes' && (
                                    <div>
                                        <div className="flex items-center justify-between mb-6 flex-wrap gap-4">
                                            <h2 className="text-2xl font-bold text-gray-800">Offertes</h2>
                                            <button
                                                onClick={() => openModal('offerte')}
                                                className="flex items-center gap-2 bg-indigo-600 text-white px-4 py-2 rounded-lg hover:bg-indigo-700 transition"
                                            >
                                                <Plus />
                                                Offerte toevoegen
                                            </button>
                                        </div>

                                        <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                                            {offertes.map(offerte => (
                                                <div key={offerte.id} className="bg-white border-2 border-gray-200 rounded-lg p-5 hover:shadow-lg transition">
                                                    <div className="flex items-start justify-between mb-3">
                                                        <div className="flex-1">
                                                            <h3 className="font-bold text-gray-800 text-lg">{offerte.leverancier}</h3>
                                                            <p className="text-gray-600 text-sm mt-1">{offerte.werk}</p>
                                                        </div>
                                                    </div>
                                                    
                                                    <div className="mb-3">
                                                        <span className={`inline-block px-3 py-1 text-sm rounded-full font-medium ${
                                                            offerte.status === 'Geaccepteerd' ? 'bg-green-100 text-green-700' :
                                                            offerte.status === 'Afgewezen' ? 'bg-red-100 text-red-700' :
                                                            'bg-yellow-100 text-yellow-700'
                                                        }`}>
                                                            {offerte.status}
                                                        </span>
                                                    </div>

                                                    <div className="space-y-2 mb-4">
                                                        <div className="flex justify-between items-center">
                                                            <span className="text-gray-600 text-sm">Bedrag:</span>
                                                            <span className="font-bold text-gray-800 text-lg">â‚¬{offerte.bedrag.toLocaleString('nl-NL')}</span>
                                                        </div>
                                                        <div className="flex justify-between items-center">
                                                            <span className="text-gray-600 text-sm">Datum:</span>
                                                            <span className="text-gray-700">{offerte.datum}</span>
                                                        </div>
                                                        <div className="flex justify-between items-center">
                                                            <span className="text-gray-600 text-sm">Budget:</span>
                                                            <span className="text-gray-700">{offerte.budgetCategorie || '-'}</span>
                                                        </div>
                                                    </div>

                                                    {offerte.notities && (
                                                        <p className="text-gray-600 text-sm mb-4 p-3 bg-gray-50 rounded">{offerte.notities}</p>
                                                    )}

                                                    <div className="flex items-center gap-2 pt-3 border-t border-gray-200">
                                                        <button
                                                            onClick={() => openModal('offerte', offerte)}
                                                            className="flex-1 flex items-center justify-center gap-2 text-blue-600 hover:text-blue-800 py-2 rounded hover:bg-blue-50 transition"
                                                        >
                                                            <Edit2 />
                                                            Bewerken
                                                        </button>
                                                        <button
                                                            onClick={() => handleDelete('offerte', offerte.id)}
                                                            className="flex-1 flex items-center justify-center gap-2 text-red-600 hover:text-red-800 py-2 rounded hover:bg-red-50 transition"
                                                        >
                                                            <X />
                                                            Verwijderen
                                                        </button>
                                                    </div>
                                                </div>
                                            ))}
                                        </div>
                                        {offertes.length === 0 && (
                                            <p className="text-gray-500 text-center py-8">Nog geen offertes toegevoegd</p>
                                        )}
                                    </div>
                                )}

                                {/* Taken Tab */}
                                {activeTab === 'taken' && (
                                    <div>
                                        <div className="flex items-center justify-between mb-6 flex-wrap gap-4">
                                            <h2 className="text-2xl font-bold text-gray-800">Taken</h2>
                                            <div className="flex items-center gap-3">
                                                <div className="flex items-center gap-2">
                                                    <Filter />
                                                    <select
                                                        value={filterPersoon}
                                                        onChange={(e) => setFilterPersoon(e.target.value)}
                                                        className="px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent"
                                                    >
                                                        <option value="Alle">Alle personen</option>
                                                        {uniekePersonen.map(persoon => (
                                                            <option key={persoon} value={persoon}>{persoon}</option>
                                                        ))}
                                                    </select>
                                                </div>
                                                <button
                                                    onClick={() => openModal('taak')}
                                                    className="flex items-center gap-2 bg-indigo-600 text-white px-4 py-2 rounded-lg hover:bg-indigo-700 transition"
                                                >
                                                    <Plus />
                                                    Taak toevoegen
                                                </button>
                                            </div>
                                        </div>

                                        <div className="space-y-3">
                                            {['Te doen', 'In uitvoering', 'Voltooid'].map(status => {
                                                // Filter en sorteer taken
                                                const statusTaken = taken
                                                    .filter(t => t.status === status)
                                                    .filter(t => filterPersoon === 'Alle' || t.toegewezenAan === filterPersoon)
                                                    .sort((a, b) => new Date(a.eindDatum) - new Date(b.eindDatum)); // Sorteer op deadline
                                                
                                                return (
                                                    <div key={status}>
                                                        <h3 className="font-bold text-gray-700 mb-3 flex items-center gap-2">
                                                            <span className={`w-3 h-3 rounded-full ${
                                                                status === 'Voltooid' ? 'bg-green-500' :
                                                                status === 'In uitvoering' ? 'bg-yellow-500' :
                                                                'bg-gray-400'
                                                            }`}></span>
                                                            {status} ({statusTaken.length})
                                                        </h3>
                                                        <div className="space-y-2 mb-6">
                                                            {statusTaken.map(taak => {
                                                                const vandaag = new Date();
                                                                vandaag.setHours(0, 0, 0, 0);
                                                                const deadline = new Date(taak.eindDatum);
                                                                const dagenTot = Math.ceil((deadline - vandaag) / (1000 * 60 * 60 * 24));
                                                                const isVerlopen = deadline < vandaag && taak.status !== 'Voltooid';
                                                                const isSpoed = dagenTot <= 3 && dagenTot >= 0 && taak.status !== 'Voltooid';
                                                                
                                                                return (
                                                                    <div key={taak.id} className={`bg-white border-2 rounded-lg p-4 hover:shadow-md transition ${
                                                                        isVerlopen ? 'border-red-300 bg-red-50' :
                                                                        isSpoed ? 'border-orange-300 bg-orange-50' :
                                                                        'border-gray-200'
                                                                    }`}>
                                                                        <div className="flex items-start justify-between">
                                                                            <div className="flex-1">
                                                                                <div className="flex items-center gap-3 mb-2 flex-wrap">
                                                                                    <h4 className="font-bold text-gray-800">{taak.taak}</h4>
                                                                                    {isVerlopen && (
                                                                                        <span className="px-2 py-1 text-xs rounded-full bg-red-100 text-red-700 font-bold">
                                                                                            âš ï¸ VERLOPEN
                                                                                        </span>
                                                                                    )}
                                                                                    {isSpoed && (
                                                                                        <span className="px-2 py-1 text-xs rounded-full bg-orange-100 text-orange-700 font-bold">
                                                                                            ðŸ”¥ URGENT ({dagenTot} {dagenTot === 1 ? 'dag' : 'dagen'})
                                                                                        </span>
                                                                                    )}
                                                                                    <span className={`px-2 py-1 text-xs rounded-full ${
                                                                                        taak.categorie === 'Diensten' ? 'bg-blue-100 text-blue-700' :
                                                                                        taak.categorie === 'Producten' ? 'bg-purple-100 text-purple-700' :
                                                                                        'bg-gray-100 text-gray-700'
                                                                                    }`}>
                                                                                        {taak.categorie || 'Overig'}
                                                                                    </span>
                                                                                    <span className={`px-2 py-1 text-xs rounded-full ${
                                                                                        taak.prioriteit === 'Hoog' ? 'bg-red-100 text-red-700' :
                                                                                        taak.prioriteit === 'Medium' ? 'bg-yellow-100 text-yellow-700' :
                                                                                        'bg-green-100 text-green-700'
                                                                                    }`}>
                                                                                        {taak.prioriteit}
                                                                                    </span>
                                                                                </div>
                                                                                <div className="text-sm text-gray-600 space-y-1">
                                                                                    <div><span className="font-medium">Toegewezen aan:</span> {taak.toegewezenAan}</div>
                                                                                    <div>
                                                                                        <span className="font-medium">Start:</span> {taak.startDatum} 
                                                                                        <span className="mx-2">â†’</span> 
                                                                                        <span className="font-medium">Deadline:</span> {taak.eindDatum}
                                                                                        {!isVerlopen && taak.status !== 'Voltooid' && (
                                                                                            <span className="ml-2 text-gray-500">
                                                                                                ({dagenTot > 0 ? `over ${dagenTot} ${dagenTot === 1 ? 'dag' : 'dagen'}` : dagenTot === 0 ? 'VANDAAG' : ''})
                                                                                            </span>
                                                                                        )}
                                                                                    </div>
                                                                                    {taak.notities && <div className="text-gray-500 italic">{taak.notities}</div>}
                                                                                </div>
                                                                            </div>
                                                                            <div className="flex items-center gap-2 ml-4">
                                                                                <button
                                                                                    onClick={() => openModal('taak', taak)}
                                                                                    className="text-blue-600 hover:text-blue-800 p-2"
                                                                                >
                                                                                    <Edit2 />
                                                                                </button>
                                                                                <button
                                                                                    onClick={() => handleDelete('taak', taak.id)}
                                                                                    className="text-red-600 hover:text-red-800 p-2"
                                                                                >
                                                                                    <X />
                                                                                </button>
                                                                            </div>
                                                                        </div>
                                                                    </div>
                                                                );
                                                            })}
                                                            {statusTaken.length === 0 && (
                                                                <p className="text-gray-500 text-center py-4 bg-gray-50 rounded">
                                                                    {filterPersoon === 'Alle' 
                                                                        ? `Geen taken met status "${status}"`
                                                                        : `Geen taken voor ${filterPersoon} met status "${status}"`
                                                                    }
                                                                </p>
                                                            )}
                                                        </div>
                                                    </div>
                                                );
                                            })}
                                        </div>
                                    </div>
                                )}

                                {/* Planning Tab */}
                                {activeTab === 'planning' && (
                                    <div>
                                        <div className="flex items-center justify-between mb-6 flex-wrap gap-4">
                                            <h2 className="text-2xl font-bold text-gray-800">Planning Overzicht</h2>
                                            <div className="flex items-center gap-3 flex-wrap">
                                                <div className="flex items-center gap-2">
                                                    <Filter />
                                                    <select
                                                        value={filterTaakCategorie}
                                                        onChange={(e) => setFilterTaakCategorie(e.target.value)}
                                                        className="px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent"
                                                    >
                                                        <option value="Alle">Alle categorieÃ«n</option>
                                                        <option value="Diensten">Diensten</option>
                                                        <option value="Producten">Producten</option>
                                                        <option value="Overig">Overig</option>
                                                    </select>
                                                </div>
                                                <select
                                                    value={filterTaakStatus}
                                                    onChange={(e) => setFilterTaakStatus(e.target.value)}
                                                    className="px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent"
                                                >
                                                    <option value="Alle">Alle statussen</option>
                                                    <option value="Te doen">Te doen</option>
                                                    <option value="In uitvoering">In uitvoering</option>
                                                    <option value="Voltooid">Voltooid</option>
                                                </select>
                                                <select
                                                    value={filterPersoon}
                                                    onChange={(e) => setFilterPersoon(e.target.value)}
                                                    className="px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent"
                                                >
                                                    <option value="Alle">Alle personen</option>
                                                    {uniekePersonen.map(persoon => (
                                                        <option key={persoon} value={persoon}>{persoon}</option>
                                                    ))}
                                                </select>
                                            </div>
                                        </div>

                                        {/* Timeline View */}
                                        <div className="space-y-6">
                                            {(() => {
                                                // Filter taken op categorie, status en persoon
                                                const gefilterdeTaken = taken
                                                    .filter(t => filterTaakCategorie === 'Alle' || t.categorie === filterTaakCategorie)
                                                    .filter(t => filterTaakStatus === 'Alle' || t.status === filterTaakStatus)
                                                    .filter(t => filterPersoon === 'Alle' || t.toegewezenAan === filterPersoon);

                                                // Sorteer taken op deadline (eindDatum)
                                                const gesorteerd = [...gefilterdeTaken].sort((a, b) => 
                                                    new Date(a.eindDatum) - new Date(b.eindDatum)
                                                );

                                                // Bereken vroegste en laatste datum voor timeline
                                                const alleDatums = gefilterdeTaken.flatMap(t => [new Date(t.startDatum), new Date(t.eindDatum)]);
                                                const vroegsteDatum = alleDatums.length > 0 ? new Date(Math.min(...alleDatums)) : new Date();
                                                const laatsteDatum = alleDatums.length > 0 ? new Date(Math.max(...alleDatums)) : new Date();
                                                const totaalDagen = Math.ceil((laatsteDatum - vroegsteDatum) / (1000 * 60 * 60 * 24)) + 1;

                                                return (
                                                    <>
                                                        {/* Maand overzicht */}
                                                        <div className="bg-gradient-to-r from-indigo-50 to-purple-50 p-6 rounded-lg border-2 border-indigo-200">
                                                            <h3 className="text-lg font-bold text-indigo-900 mb-4">Planning Samenvatting</h3>
                                                            <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
                                                                <div>
                                                                    <div className="text-sm text-indigo-700">
                                                                        {filterTaakCategorie === 'Alle' ? 'Totaal taken' : `${filterTaakCategorie} taken`}
                                                                    </div>
                                                                    <div className="text-2xl font-bold text-indigo-900">{gefilterdeTaken.length}</div>
                                                                </div>
                                                                <div>
                                                                    <div className="text-sm text-indigo-700">Planning periode</div>
                                                                    <div className="text-lg font-bold text-indigo-900">
                                                                        {gefilterdeTaken.length > 0 ? (
                                                                            <>{vroegsteDatum.toLocaleDateString('nl-NL', { day: 'numeric', month: 'short' })} - {laatsteDatum.toLocaleDateString('nl-NL', { day: 'numeric', month: 'short', year: 'numeric' })}</>
                                                                        ) : '-'}
                                                                    </div>
                                                                </div>
                                                                <div>
                                                                    <div className="text-sm text-indigo-700">Totaal dagen</div>
                                                                    <div className="text-2xl font-bold text-indigo-900">{gefilterdeTaken.length > 0 ? totaalDagen : 0}</div>
                                                                </div>
                                                            </div>
                                                        </div>

                                                        {/* Timeline visualisatie */}
                                                        <div className="bg-white border-2 border-gray-200 rounded-lg p-6">
                                                            <h3 className="text-lg font-bold text-gray-800 mb-6">Tijdlijn Weergave</h3>
                                                            
                                                            <div className="space-y-4">
                                                                {gesorteerd.map(taak => {
                                                                    const start = new Date(taak.startDatum);
                                                                    const eind = new Date(taak.eindDatum);
                                                                    const duur = Math.ceil((eind - start) / (1000 * 60 * 60 * 24)) + 1;
                                                                    const startOffset = Math.ceil((start - vroegsteDatum) / (1000 * 60 * 60 * 24));
                                                                    const breedte = totaalDagen > 0 ? (duur / totaalDagen * 100) : 0;
                                                                    const offsetPercentage = totaalDagen > 0 ? (startOffset / totaalDagen * 100) : 0;

                                                                    const vandaag = new Date();
                                                                    vandaag.setHours(0, 0, 0, 0);
                                                                    const isVerlopen = eind < vandaag && taak.status !== 'Voltooid';
                                                                    const isActief = start <= vandaag && eind >= vandaag;

                                                                    return (
                                                                        <div 
                                                                            key={taak.id} 
                                                                            className="relative cursor-pointer hover:bg-gray-50 p-3 rounded-lg transition"
                                                                            onClick={() => openModal('taak', taak)}
                                                                        >
                                                                            {/* Taak info */}
                                                                            <div className="flex items-center gap-3 mb-2">
                                                                                <div className="flex-1 min-w-0">
                                                                                    <div className="font-medium text-gray-800 truncate">{taak.taak}</div>
                                                                                    <div className="text-sm text-gray-600">
                                                                                        {taak.toegewezenAan} â€¢ {start.toLocaleDateString('nl-NL', { day: 'numeric', month: 'short' })} - {eind.toLocaleDateString('nl-NL', { day: 'numeric', month: 'short' })} ({duur} {duur === 1 ? 'dag' : 'dagen'})
                                                                                    </div>
                                                                                </div>
                                                                                <div className="flex items-center gap-2">
                                                                                    <span className={`px-2 py-1 text-xs rounded-full ${
                                                                                        taak.categorie === 'Diensten' ? 'bg-blue-100 text-blue-700' :
                                                                                        taak.categorie === 'Producten' ? 'bg-purple-100 text-purple-700' :
                                                                                        'bg-gray-100 text-gray-700'
                                                                                    }`}>
                                                                                        {taak.categorie || 'Overig'}
                                                                                    </span>
                                                                                    <span className={`px-2 py-1 text-xs rounded-full ${
                                                                                        taak.status === 'Voltooid' ? 'bg-green-100 text-green-700' :
                                                                                        taak.status === 'In uitvoering' ? 'bg-blue-100 text-blue-700' :
                                                                                        'bg-gray-100 text-gray-700'
                                                                                    }`}>
                                                                                        {taak.status}
                                                                                    </span>
                                                                                    <span className={`px-2 py-1 text-xs rounded-full ${
                                                                                        taak.prioriteit === 'Hoog' ? 'bg-red-100 text-red-700' :
                                                                                        taak.prioriteit === 'Medium' ? 'bg-yellow-100 text-yellow-700' :
                                                                                        'bg-green-100 text-green-700'
                                                                                    }`}>
                                                                                        {taak.prioriteit}
                                                                                    </span>
                                                                                </div>
                                                                            </div>

                                                                            {/* Timeline bar */}
                                                                            <div className="relative h-10 bg-gray-100 rounded-lg overflow-hidden">
                                                                                <div
                                                                                    className={`absolute h-full rounded transition-all ${
                                                                                        isVerlopen ? 'bg-red-400' :
                                                                                        taak.status === 'Voltooid' ? 'bg-green-400' :
                                                                                        isActief ? 'bg-blue-400' :
                                                                                        'bg-indigo-400'
                                                                                    }`}
                                                                                    style={{
                                                                                        left: `${offsetPercentage}%`,
                                                                                        width: `${breedte}%`
                                                                                    }}
                                                                                >
                                                                                    {isVerlopen && (
                                                                                        <div className="absolute inset-0 flex items-center justify-center">
                                                                                            <span className="text-xs font-bold text-white">VERLOPEN</span>
                                                                                        </div>
                                                                                    )}
                                                                                    {isActief && taak.status !== 'Voltooid' && (
                                                                                        <div className="absolute inset-0 flex items-center justify-center">
                                                                                            <span className="text-xs font-bold text-white">BEZIG</span>
                                                                                        </div>
                                                                                    )}
                                                                                </div>
                                                                            </div>
                                                                            
                                                                            {/* Click hint */}
                                                                            <div className="text-xs text-gray-500 mt-1 text-right">Klik om te bewerken</div>
                                                                        </div>
                                                                    );
                                                                })}
                                                            </div>

                                                            {gesorteerd.length === 0 && (
                                                                <p className="text-gray-500 text-center py-8">
                                                                    {filterTaakCategorie === 'Alle' && filterPersoon === 'Alle' && filterTaakStatus === 'Alle'
                                                                        ? 'Nog geen taken met planning toegevoegd'
                                                                        : `Geen taken gevonden met de huidige filters`
                                                                    }
                                                                </p>
                                                            )}
                                                        </div>

                                                        {/* Kalender weergave per maand */}
                                                        <div className="bg-white border-2 border-gray-200 rounded-lg p-6">
                                                            <h3 className="text-lg font-bold text-gray-800 mb-6">Taken per Maand</h3>
                                                            
                                                            <div className="space-y-6">
                                                                {(() => {
                                                                    // Groepeer taken per maand
                                                                    const takenPerMaand = {};
                                                                    gefilterdeTaken.forEach(taak => {
                                                                        const maand = new Date(taak.startDatum).toLocaleDateString('nl-NL', { year: 'numeric', month: 'long' });
                                                                        if (!takenPerMaand[maand]) {
                                                                            takenPerMaand[maand] = [];
                                                                        }
                                                                        takenPerMaand[maand].push(taak);
                                                                    });

                                                                    return Object.entries(takenPerMaand)
                                                                        .sort(([a], [b]) => new Date(a) - new Date(b))
                                                                        .map(([maand, maandTaken]) => (
                                                                            <div key={maand} className="border-l-4 border-indigo-500 pl-4">
                                                                                <h4 className="font-bold text-gray-800 mb-3 capitalize">{maand}</h4>
                                                                                <div className="space-y-2">
                                                                                    {maandTaken.sort((a, b) => new Date(a.startDatum) - new Date(b.startDatum)).map(taak => (
                                                                                        <div 
                                                                                            key={taak.id} 
                                                                                            className="flex items-center justify-between p-3 bg-gray-50 rounded-lg hover:bg-indigo-50 transition cursor-pointer"
                                                                                            onClick={() => openModal('taak', taak)}
                                                                                        >
                                                                                            <div className="flex-1">
                                                                                                <div className="font-medium text-gray-800">{taak.taak}</div>
                                                                                                <div className="text-sm text-gray-600 mt-1">
                                                                                                    {taak.toegewezenAan} â€¢ {taak.startDatum} tot {taak.eindDatum}
                                                                                                </div>
                                                                                            </div>
                                                                                            <div className="flex items-center gap-2 ml-4">
                                                                                                <span className={`px-2 py-1 text-xs rounded-full whitespace-nowrap ${
                                                                                                    taak.categorie === 'Diensten' ? 'bg-blue-100 text-blue-700' :
                                                                                                    taak.categorie === 'Producten' ? 'bg-purple-100 text-purple-700' :
                                                                                                    'bg-gray-100 text-gray-700'
                                                                                                }`}>
                                                                                                    {taak.categorie || 'Overig'}
                                                                                                </span>
                                                                                                <span className={`px-2 py-1 text-xs rounded-full whitespace-nowrap ${
                                                                                                    taak.status === 'Voltooid' ? 'bg-green-100 text-green-700' :
                                                                                                    taak.status === 'In uitvoering' ? 'bg-blue-100 text-blue-700' :
                                                                                                    'bg-gray-100 text-gray-700'
                                                                                                }`}>
                                                                                                    {taak.status}
                                                                                                </span>
                                                                                                <span className={`px-2 py-1 text-xs rounded-full whitespace-nowrap ${
                                                                                                    taak.prioriteit === 'Hoog' ? 'bg-red-100 text-red-700' :
                                                                                                    taak.prioriteit === 'Medium' ? 'bg-yellow-100 text-yellow-700' :
                                                                                                    'bg-green-100 text-green-700'
                                                                                                }`}>
                                                                                                    {taak.prioriteit}
                                                                                                </span>
                                                                                                <Edit2 />
                                                                                            </div>
                                                                                        </div>
                                                                                    ))}
                                                                                </div>
                                                                            </div>
                                                                        ));
                                                                })()}

                                                                {gefilterdeTaken.length === 0 && (
                                                                    <p className="text-gray-500 text-center py-4">
                                                                        {filterTaakCategorie === 'Alle' && filterPersoon === 'Alle' && filterTaakStatus === 'Alle'
                                                                            ? 'Nog geen taken gepland'
                                                                            : 'Geen taken gevonden met de huidige filters'
                                                                        }
                                                                    </p>
                                                                )}
                                                            </div>
                                                        </div>
                                                    </>
                                                );
                                            })()}
                                        </div>
                                    </div>
                                )}

                                {/* Budget Tab */}
                                {activeTab === 'budget' && (
                                    <div>
                                        <div className="flex items-center justify-between mb-6 flex-wrap gap-4">
                                            <h2 className="text-2xl font-bold text-gray-800">Budget</h2>
                                            <button
                                                onClick={() => openModal('budget')}
                                                className="flex items-center gap-2 bg-indigo-600 text-white px-4 py-2 rounded-lg hover:bg-indigo-700 transition"
                                            >
                                                <Plus />
                                                Categorie toevoegen
                                            </button>
                                        </div>

                                        <div className="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                                            <div className="bg-gradient-to-br from-blue-50 to-blue-100 p-6 rounded-lg border-2 border-blue-200">
                                                <div className="text-blue-700 font-medium mb-2">Totaal Gepland</div>
                                                <div className="text-3xl font-bold text-blue-800">â‚¬{stats.totaalGepland.toLocaleString('nl-NL')}</div>
                                            </div>
                                            <div className="bg-gradient-to-br from-green-50 to-green-100 p-6 rounded-lg border-2 border-green-200">
                                                <div className="text-green-700 font-medium mb-2">Totaal Uitgegeven</div>
                                                <div className="text-3xl font-bold text-green-800">â‚¬{stats.totaalUitgegeven.toLocaleString('nl-NL')}</div>
                                                <div className="text-sm text-green-600 mt-1">Gekocht + Geaccepteerd</div>
                                            </div>
                                            <div className="bg-gradient-to-br from-orange-50 to-orange-100 p-6 rounded-lg border-2 border-orange-200">
                                                <div className="text-orange-700 font-medium mb-2">Nog Te Kopen</div>
                                                <div className="text-3xl font-bold text-orange-800">â‚¬{stats.totaalNogTeKopen.toLocaleString('nl-NL')}</div>
                                                <div className="text-sm text-orange-600 mt-1">Gepland + Ontvangen</div>
                                            </div>
                                        </div>

                                        <div className="bg-gradient-to-br from-purple-50 to-purple-100 p-6 rounded-lg border-2 border-purple-200 mb-8">
                                            <div className="flex items-center justify-between">
                                                <div>
                                                    <div className="text-purple-700 font-medium mb-2">Nog Beschikbaar</div>
                                                    <div className="text-3xl font-bold text-purple-800">â‚¬{stats.resterendBudget.toLocaleString('nl-NL')}</div>
                                                </div>
                                                <div className="text-right">
                                                    <div className="text-sm text-purple-600">Totaal verwacht:</div>
                                                    <div className="text-xl font-bold text-purple-700">â‚¬{stats.totaalVerwacht.toLocaleString('nl-NL')}</div>
                                                </div>
                                            </div>
                                        </div>

                                        <div className="space-y-4">
                                            {calculateBudgetDetails.map(item => {
                                                const percentageUitgegeven = item.gepland > 0 ? (item.uitgegeven / item.gepland * 100).toFixed(0) : 0;
                                                const percentageVerwacht = item.gepland > 0 ? (item.totaalVerwacht / item.gepland * 100).toFixed(0) : 0;
                                                const isOverBudget = item.totaalVerwacht > item.gepland;
                                                
                                                return (
                                                    <div 
                                                        key={item.id} 
                                                        className="bg-white border-2 border-gray-200 rounded-lg p-5 hover:shadow-lg transition cursor-pointer"
                                                        onClick={() => {
                                                            setEditItem(item);
                                                            setModalType('budgetDetails');
                                                            setShowModal(true);
                                                        }}
                                                    >
                                                        <div className="flex items-start justify-between mb-3">
                                                            <div className="flex-1">
                                                                <div className="flex items-center gap-2">
                                                                    <h3 className="font-bold text-gray-800 text-lg mb-1">{item.categorie}</h3>
                                                                    <span className="text-xs text-indigo-600 bg-indigo-50 px-2 py-1 rounded">
                                                                        Klik voor details
                                                                    </span>
                                                                </div>
                                                                {item.notities && <p className="text-gray-600 text-sm">{item.notities}</p>}
                                                            </div>
                                                            <div className="flex items-center gap-2 ml-4">
                                                                <button
                                                                    onClick={(e) => {
                                                                        e.stopPropagation();
                                                                        openModal('budget', item);
                                                                    }}
                                                                    className="text-blue-600 hover:text-blue-800 p-2"
                                                                >
                                                                    <Edit2 />
                                                                </button>
                                                                <button
                                                                    onClick={(e) => {
                                                                        e.stopPropagation();
                                                                        handleDelete('budget', item.id);
                                                                    }}
                                                                    className="text-red-600 hover:text-red-800 p-2"
                                                                >
                                                                    <X />
                                                                </button>
                                                            </div>
                                                        </div>

                                                        <div className="grid grid-cols-2 md:grid-cols-4 gap-4 mb-3">
                                                            <div>
                                                                <div className="text-gray-600 text-sm">Gepland</div>
                                                                <div className="font-bold text-gray-800">â‚¬{item.gepland.toLocaleString('nl-NL')}</div>
                                                            </div>
                                                            <div>
                                                                <div className="text-gray-600 text-sm">Uitgegeven</div>
                                                                <div className="font-bold text-green-600">â‚¬{item.uitgegeven.toLocaleString('nl-NL')}</div>
                                                            </div>
                                                            <div>
                                                                <div className="text-gray-600 text-sm">Nog te kopen</div>
                                                                <div className="font-bold text-orange-600">â‚¬{item.nogTeKopen.toLocaleString('nl-NL')}</div>
                                                            </div>
                                                            <div>
                                                                <div className="text-gray-600 text-sm">Resterend</div>
                                                                <div className={`font-bold ${isOverBudget ? 'text-red-600' : 'text-purple-600'}`}>
                                                                    â‚¬{item.resterend.toLocaleString('nl-NL')}
                                                                </div>
                                                            </div>
                                                        </div>

                                                        <div className="space-y-2">
                                                            <div>
                                                                <div className="flex justify-between text-sm mb-1">
                                                                    <span className="text-gray-600">Uitgegeven ({percentageUitgegeven}%)</span>
                                                                </div>
                                                                <div className="w-full bg-gray-200 rounded-full h-2">
                                                                    <div
                                                                        className="bg-green-500 h-2 rounded-full transition-all"
                                                                        style={{ width: `${Math.min(percentageUitgegeven, 100)}%` }}
                                                                    ></div>
                                                                </div>
                                                            </div>
                                                            <div>
                                                                <div className="flex justify-between text-sm mb-1">
                                                                    <span className="text-gray-600">Totaal verwacht ({percentageVerwacht}%)</span>
                                                                </div>
                                                                <div className="w-full bg-gray-200 rounded-full h-2">
                                                                    <div
                                                                        className={`h-2 rounded-full transition-all ${
                                                                            isOverBudget ? 'bg-red-500' : 'bg-blue-500'
                                                                        }`}
                                                                        style={{ width: `${Math.min(percentageVerwacht, 100)}%` }}
                                                                    ></div>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                );
                                            })}
                                        </div>
                                        {budgetItems.length === 0 && (
                                            <p className="text-gray-500 text-center py-8">Nog geen budgetcategorieÃ«n toegevoegd</p>
                                        )}
                                    </div>
                                )}
                            </div>
                        </div>
                    </div>

                    {/* Modal */}
                    {showModal && (
                        <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50" onClick={closeModal}>
                            <div className="bg-white rounded-lg max-w-2xl w-full max-h-[90vh] overflow-y-auto" onClick={(e) => e.stopPropagation()}>
                                <div className="p-6 border-b border-gray-200">
                                    <h3 className="text-xl font-bold text-gray-800">
                                        {modalType === 'budgetDetails' ? `Budget Details - ${editItem?.categorie}` :
                                         editItem ? 'Bewerken' : 'Toevoegen'} {modalType === 'budgetDetails' ? '' : 
                                         modalType === 'product' ? '- Product' :
                                         modalType === 'offerte' ? '- Offerte' :
                                         modalType === 'taak' ? '- Taak' : '- Budget'}
                                    </h3>
                                </div>

                                {modalType === 'budgetDetails' ? (
                                    <div className="p-6">
                                        {/* Budget summary */}
                                        <div className="bg-gradient-to-r from-indigo-50 to-purple-50 p-4 rounded-lg mb-6 border-2 border-indigo-200">
                                            <div className="grid grid-cols-2 md:grid-cols-4 gap-4">
                                                <div>
                                                    <div className="text-sm text-indigo-700">Gepland</div>
                                                    <div className="text-xl font-bold text-indigo-900">â‚¬{editItem.gepland.toLocaleString('nl-NL')}</div>
                                                </div>
                                                <div>
                                                    <div className="text-sm text-green-700">Uitgegeven</div>
                                                    <div className="text-xl font-bold text-green-800">â‚¬{editItem.uitgegeven.toLocaleString('nl-NL')}</div>
                                                </div>
                                                <div>
                                                    <div className="text-sm text-orange-700">Nog te kopen</div>
                                                    <div className="text-xl font-bold text-orange-800">â‚¬{editItem.nogTeKopen.toLocaleString('nl-NL')}</div>
                                                </div>
                                                <div>
                                                    <div className="text-sm text-purple-700">Resterend</div>
                                                    <div className={`text-xl font-bold ${editItem.resterend < 0 ? 'text-red-600' : 'text-purple-800'}`}>
                                                        â‚¬{editItem.resterend.toLocaleString('nl-NL')}
                                                    </div>
                                                </div>
                                            </div>
                                        </div>

                                        {/* Producten */}
                                        <div className="mb-6">
                                            <h4 className="font-bold text-gray-800 mb-3 flex items-center gap-2">
                                                <Package />
                                                Producten
                                            </h4>
                                            {(() => {
                                                const budgetProducten = producten.filter(p => p.budgetCategorie === editItem.categorie);
                                                const teKopenGekocht = budgetProducten.filter(p => p.gekocht && p.type !== 'Wishlist');
                                                const teKopenNogKopen = budgetProducten.filter(p => !p.gekocht && p.type !== 'Wishlist');
                                                const wishlist = budgetProducten.filter(p => p.type === 'Wishlist');

                                                return (
                                                    <div className="space-y-3">
                                                        {teKopenGekocht.length > 0 && (
                                                            <div>
                                                                <div className="text-sm font-medium text-green-700 mb-2">âœ“ Gekocht ({teKopenGekocht.length})</div>
                                                                {teKopenGekocht.map(product => (
                                                                    <div key={product.id} className="flex items-center justify-between p-3 bg-green-50 rounded-lg mb-2">
                                                                        <div className="flex items-center gap-3 flex-1">
                                                                            {product.afbeelding && (
                                                                                <img src={product.afbeelding} alt={product.naam} className="w-12 h-12 object-cover rounded border" />
                                                                            )}
                                                                            <div>
                                                                                <div className="font-medium text-gray-800">{product.naam}</div>
                                                                                <div className="text-sm text-gray-600">{product.leverancier}</div>
                                                                            </div>
                                                                        </div>
                                                                        <div className="font-bold text-green-700">â‚¬{product.prijs.toLocaleString('nl-NL')}</div>
                                                                    </div>
                                                                ))}
                                                            </div>
                                                        )}

                                                        {teKopenNogKopen.length > 0 && (
                                                            <div>
                                                                <div className="text-sm font-medium text-orange-700 mb-2">â—‹ Nog te kopen ({teKopenNogKopen.length})</div>
                                                                {teKopenNogKopen.map(product => (
                                                                    <div key={product.id} className="flex items-center justify-between p-3 bg-orange-50 rounded-lg mb-2">
                                                                        <div className="flex items-center gap-3 flex-1">
                                                                            {product.afbeelding && (
                                                                                <img src={product.afbeelding} alt={product.naam} className="w-12 h-12 object-cover rounded border" />
                                                                            )}
                                                                            <div>
                                                                                <div className="font-medium text-gray-800">{product.naam}</div>
                                                                                <div className="text-sm text-gray-600">{product.leverancier}</div>
                                                                            </div>
                                                                        </div>
                                                                        <div className="font-bold text-orange-700">â‚¬{product.prijs.toLocaleString('nl-NL')}</div>
                                                                    </div>
                                                                ))}
                                                            </div>
                                                        )}

                                                        {wishlist.length > 0 && (
                                                            <div>
                                                                <div className="text-sm font-medium text-pink-700 mb-2">ðŸ’­ Wishlist (telt niet mee in budget) ({wishlist.length})</div>
                                                                {wishlist.map(product => (
                                                                    <div key={product.id} className="flex items-center justify-between p-3 bg-pink-50 rounded-lg mb-2 border border-pink-200">
                                                                        <div className="flex items-center gap-3 flex-1">
                                                                            {product.afbeelding && (
                                                                                <img src={product.afbeelding} alt={product.naam} className="w-12 h-12 object-cover rounded border" />
                                                                            )}
                                                                            <div>
                                                                                <div className="font-medium text-gray-800">{product.naam}</div>
                                                                                <div className="text-sm text-gray-600">
                                                                                    {product.leverancier}
                                                                                    {product.gekocht && <span className="ml-2 text-green-600 font-medium">âœ“ Gekocht</span>}
                                                                                </div>
                                                                            </div>
                                                                        </div>
                                                                        <div className="font-bold text-pink-700">â‚¬{product.prijs.toLocaleString('nl-NL')}</div>
                                                                    </div>
                                                                ))}
                                                            </div>
                                                        )}

                                                        {budgetProducten.length === 0 && (
                                                            <p className="text-gray-500 text-center py-4 bg-gray-50 rounded">Geen producten gekoppeld</p>
                                                        )}
                                                    </div>
                                                );
                                            })()}
                                        </div>

                                        {/* Offertes */}
                                        <div>
                                            <h4 className="font-bold text-gray-800 mb-3 flex items-center gap-2">
                                                <FileText />
                                                Offertes
                                            </h4>
                                            {(() => {
                                                const budgetOffertes = offertes.filter(o => o.budgetCategorie === editItem.categorie);
                                                const geaccepteerd = budgetOffertes.filter(o => o.status === 'Geaccepteerd');
                                                const ontvangen = budgetOffertes.filter(o => o.status === 'Ontvangen');
                                                const afgewezen = budgetOffertes.filter(o => o.status === 'Afgewezen');

                                                return (
                                                    <div className="space-y-3">
                                                        {geaccepteerd.length > 0 && (
                                                            <div>
                                                                <div className="text-sm font-medium text-green-700 mb-2">âœ“ Geaccepteerd ({geaccepteerd.length})</div>
                                                                {geaccepteerd.map(offerte => (
                                                                    <div key={offerte.id} className="flex items-center justify-between p-3 bg-green-50 rounded-lg mb-2">
                                                                        <div>
                                                                            <div className="font-medium text-gray-800">{offerte.leverancier}</div>
                                                                            <div className="text-sm text-gray-600">{offerte.werk}</div>
                                                                        </div>
                                                                        <div className="font-bold text-green-700">â‚¬{offerte.bedrag.toLocaleString('nl-NL')}</div>
                                                                    </div>
                                                                ))}
                                                            </div>
                                                        )}

                                                        {ontvangen.length > 0 && (
                                                            <div>
                                                                <div className="text-sm font-medium text-orange-700 mb-2">â—‹ Ontvangen ({ontvangen.length})</div>
                                                                {ontvangen.map(offerte => (
                                                                    <div key={offerte.id} className="flex items-center justify-between p-3 bg-orange-50 rounded-lg mb-2">
                                                                        <div>
                                                                            <div className="font-medium text-gray-800">{offerte.leverancier}</div>
                                                                            <div className="text-sm text-gray-600">{offerte.werk}</div>
                                                                        </div>
                                                                        <div className="font-bold text-orange-700">â‚¬{offerte.bedrag.toLocaleString('nl-NL')}</div>
                                                                    </div>
                                                                ))}
                                                            </div>
                                                        )}

                                                        {afgewezen.length > 0 && (
                                                            <div>
                                                                <div className="text-sm font-medium text-gray-500 mb-2">âœ— Afgewezen ({afgewezen.length})</div>
                                                                {afgewezen.map(offerte => (
                                                                    <div key={offerte.id} className="flex items-center justify-between p-3 bg-gray-50 rounded-lg mb-2 opacity-60">
                                                                        <div>
                                                                            <div className="font-medium text-gray-600">{offerte.leverancier}</div>
                                                                            <div className="text-sm text-gray-500">{offerte.werk}</div>
                                                                        </div>
                                                                        <div className="font-bold text-gray-500 line-through">â‚¬{offerte.bedrag.toLocaleString('nl-NL')}</div>
                                                                    </div>
                                                                ))}
                                                            </div>
                                                        )}

                                                        {budgetOffertes.length === 0 && (
                                                            <p className="text-gray-500 text-center py-4 bg-gray-50 rounded">Geen offertes gekoppeld</p>
                                                        )}
                                                    </div>
                                                );
                                            })()}
                                        </div>

                                        <div className="flex items-center gap-3 mt-6 pt-4 border-t border-gray-200">
                                            <button
                                                onClick={closeModal}
                                                className="flex-1 bg-indigo-600 text-white px-6 py-2 rounded-lg hover:bg-indigo-700 transition font-medium"
                                            >
                                                Sluiten
                                            </button>
                                        </div>
                                    </div>
                                ) : (
                                    <form onSubmit={handleSubmit} className="p-6">
                                    {modalType === 'product' && (
                                        <div className="space-y-4">
                                            <div>
                                                <label className="block text-sm font-medium text-gray-700 mb-1">Naam *</label>
                                                <input
                                                    type="text"
                                                    required
                                                    value={formData.naam || ''}
                                                    onChange={(e) => setFormData({ ...formData, naam: e.target.value })}
                                                    className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent"
                                                />
                                            </div>
                                            <div>
                                                <label className="block text-sm font-medium text-gray-700 mb-1">Type *</label>
                                                <select
                                                    required
                                                    value={formData.type || ''}
                                                    onChange={(e) => setFormData({ ...formData, type: e.target.value })}
                                                    className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent"
                                                >
                                                    <option value="">Selecteer type...</option>
                                                    <option value="Te kopen">Te kopen (telt mee in budget)</option>
                                                    <option value="Wishlist">Wishlist (telt niet mee in budget)</option>
                                                </select>
                                            </div>
                                            <div>
                                                <label className="block text-sm font-medium text-gray-700 mb-1">Afbeelding</label>
                                                <div className="space-y-2">
                                                    <input
                                                        type="file"
                                                        accept="image/*"
                                                        onChange={(e) => {
                                                            const file = e.target.files[0];
                                                            if (file) {
                                                                const reader = new FileReader();
                                                                reader.onload = (event) => {
                                                                    setFormData({ ...formData, afbeelding: event.target.result });
                                                                };
                                                                reader.readAsDataURL(file);
                                                            }
                                                        }}
                                                        className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent"
                                                    />
                                                    {formData.afbeelding && (
                                                        <div className="relative">
                                                            <img 
                                                                src={formData.afbeelding} 
                                                                alt="Preview" 
                                                                className="w-full h-48 object-cover rounded-lg border-2 border-gray-200"
                                                            />
                                                            <button
                                                                type="button"
                                                                onClick={() => setFormData({ ...formData, afbeelding: null })}
                                                                className="absolute top-2 right-2 bg-red-500 text-white p-2 rounded-full hover:bg-red-600 transition"
                                                            >
                                                                <X />
                                                            </button>
                                                        </div>
                                                    )}
                                                </div>
                                            </div>
                                            <div>
                                                <label className="block text-sm font-medium text-gray-700 mb-1">Categorie *</label>
                                                <input
                                                    type="text"
                                                    required
                                                    value={formData.categorie || ''}
                                                    onChange={(e) => setFormData({ ...formData, categorie: e.target.value })}
                                                    className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent"
                                                />
                                            </div>
                                            <div>
                                                <label className="block text-sm font-medium text-gray-700 mb-1">Prijs (â‚¬) *</label>
                                                <input
                                                    type="number"
                                                    required
                                                    step="0.01"
                                                    value={formData.prijs || ''}
                                                    onChange={(e) => setFormData({ ...formData, prijs: parseFloat(e.target.value) })}
                                                    className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent"
                                                />
                                            </div>
                                            <div>
                                                <label className="block text-sm font-medium text-gray-700 mb-1">Budget Categorie *</label>
                                                <select
                                                    required
                                                    value={formData.budgetCategorie || ''}
                                                    onChange={(e) => setFormData({ ...formData, budgetCategorie: e.target.value })}
                                                    className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent"
                                                >
                                                    <option value="">Selecteer budget categorie</option>
                                                    {budgetItems.map(b => (
                                                        <option key={b.id} value={b.categorie}>{b.categorie}</option>
                                                    ))}
                                                </select>
                                            </div>
                                            <div>
                                                <label className="block text-sm font-medium text-gray-700 mb-1">Leverancier</label>
                                                <input
                                                    type="text"
                                                    value={formData.leverancier || ''}
                                                    onChange={(e) => setFormData({ ...formData, leverancier: e.target.value })}
                                                    className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent"
                                                />
                                            </div>
                                            <div>
                                                <label className="block text-sm font-medium text-gray-700 mb-1">Link naar webshop</label>
                                                <input
                                                    type="url"
                                                    value={formData.link || ''}
                                                    onChange={(e) => setFormData({ ...formData, link: e.target.value })}
                                                    className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent"
                                                    placeholder="https://..."
                                                />
                                            </div>
                                            <div>
                                                <label className="block text-sm font-medium text-gray-700 mb-1">Notities</label>
                                                <textarea
                                                    value={formData.notities || ''}
                                                    onChange={(e) => setFormData({ ...formData, notities: e.target.value })}
                                                    rows="3"
                                                    className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent"
                                                />
                                            </div>
                                        </div>
                                    )}

                                    {modalType === 'offerte' && (
                                        <div className="space-y-4">
                                            <div>
                                                <label className="block text-sm font-medium text-gray-700 mb-1">Leverancier *</label>
                                                <input
                                                    type="text"
                                                    required
                                                    value={formData.leverancier || ''}
                                                    onChange={(e) => setFormData({ ...formData, leverancier: e.target.value })}
                                                    className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent"
                                                />
                                            </div>
                                            <div>
                                                <label className="block text-sm font-medium text-gray-700 mb-1">Type werk *</label>
                                                <input
                                                    type="text"
                                                    required
                                                    value={formData.werk || ''}
                                                    onChange={(e) => setFormData({ ...formData, werk: e.target.value })}
                                                    className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent"
                                                />
                                            </div>
                                            <div>
                                                <label className="block text-sm font-medium text-gray-700 mb-1">Bedrag (â‚¬) *</label>
                                                <input
                                                    type="number"
                                                    required
                                                    step="0.01"
                                                    value={formData.bedrag || ''}
                                                    onChange={(e) => setFormData({ ...formData, bedrag: parseFloat(e.target.value) })}
                                                    className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent"
                                                />
                                            </div>
                                            <div>
                                                <label className="block text-sm font-medium text-gray-700 mb-1">Budget Categorie *</label>
                                                <select
                                                    required
                                                    value={formData.budgetCategorie || ''}
                                                    onChange={(e) => setFormData({ ...formData, budgetCategorie: e.target.value })}
                                                    className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent"
                                                >
                                                    <option value="">Selecteer budget categorie</option>
                                                    {budgetItems.map(b => (
                                                        <option key={b.id} value={b.categorie}>{b.categorie}</option>
                                                    ))}
                                                </select>
                                            </div>
                                            <div>
                                                <label className="block text-sm font-medium text-gray-700 mb-1">Datum *</label>
                                                <input
                                                    type="date"
                                                    required
                                                    value={formData.datum || ''}
                                                    onChange={(e) => setFormData({ ...formData, datum: e.target.value })}
                                                    className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent"
                                                />
                                            </div>
                                            <div>
                                                <label className="block text-sm font-medium text-gray-700 mb-1">Status *</label>
                                                <select
                                                    required
                                                    value={formData.status || 'Ontvangen'}
                                                    onChange={(e) => setFormData({ ...formData, status: e.target.value })}
                                                    className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent"
                                                >
                                                    <option value="Ontvangen">Ontvangen</option>
                                                    <option value="Geaccepteerd">Geaccepteerd</option>
                                                    <option value="Afgewezen">Afgewezen</option>
                                                </select>
                                            </div>
                                            <div>
                                                <label className="block text-sm font-medium text-gray-700 mb-1">Notities</label>
                                                <textarea
                                                    value={formData.notities || ''}
                                                    onChange={(e) => setFormData({ ...formData, notities: e.target.value })}
                                                    rows="3"
                                                    className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent"
                                                />
                                            </div>
                                        </div>
                                    )}

                                    {modalType === 'taak' && (
                                        <div className="space-y-4">
                                            <div>
                                                <label className="block text-sm font-medium text-gray-700 mb-1">Taak *</label>
                                                <input
                                                    type="text"
                                                    required
                                                    value={formData.taak || ''}
                                                    onChange={(e) => setFormData({ ...formData, taak: e.target.value })}
                                                    className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent"
                                                />
                                            </div>
                                            <div>
                                                <label className="block text-sm font-medium text-gray-700 mb-1">Categorie *</label>
                                                <select
                                                    required
                                                    value={formData.categorie || ''}
                                                    onChange={(e) => setFormData({ ...formData, categorie: e.target.value })}
                                                    className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent"
                                                >
                                                    <option value="">Selecteer categorie...</option>
                                                    <option value="Diensten">Diensten</option>
                                                    <option value="Producten">Producten</option>
                                                    <option value="Overig">Overig</option>
                                                </select>
                                            </div>
                                            <div>
                                                <label className="block text-sm font-medium text-gray-700 mb-1">Toegewezen aan *</label>
                                                <input
                                                    type="text"
                                                    required
                                                    value={formData.toegewezenAan || ''}
                                                    onChange={(e) => setFormData({ ...formData, toegewezenAan: e.target.value })}
                                                    className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent"
                                                    placeholder="Bijv. Jan, Marie..."
                                                />
                                            </div>
                                            <div>
                                                <label className="block text-sm font-medium text-gray-700 mb-1">Prioriteit *</label>
                                                <select
                                                    required
                                                    value={formData.prioriteit || ''}
                                                    onChange={(e) => setFormData({ ...formData, prioriteit: e.target.value })}
                                                    className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent"
                                                >
                                                    <option value="">Selecteer prioriteit...</option>
                                                    <option value="Laag">Laag</option>
                                                    <option value="Medium">Medium</option>
                                                    <option value="Hoog">Hoog</option>
                                                </select>
                                            </div>
                                            <div>
                                                <label className="block text-sm font-medium text-gray-700 mb-1">Status *</label>
                                                <select
                                                    required
                                                    value={formData.status || ''}
                                                    onChange={(e) => setFormData({ ...formData, status: e.target.value })}
                                                    className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent"
                                                >
                                                    <option value="">Selecteer status...</option>
                                                    <option value="Te doen">Te doen</option>
                                                    <option value="In uitvoering">In uitvoering</option>
                                                    <option value="Voltooid">Voltooid</option>
                                                </select>
                                            </div>
                                            <div className="grid grid-cols-2 gap-4">
                                                <div>
                                                    <label className="block text-sm font-medium text-gray-700 mb-1">Start datum *</label>
                                                    <input
                                                        type="date"
                                                        required
                                                        value={formData.startDatum || ''}
                                                        onChange={(e) => setFormData({ ...formData, startDatum: e.target.value })}
                                                        className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent"
                                                    />
                                                </div>
                                                <div>
                                                    <label className="block text-sm font-medium text-gray-700 mb-1">Eind datum (deadline) *</label>
                                                    <input
                                                        type="date"
                                                        required
                                                        value={formData.eindDatum || ''}
                                                        onChange={(e) => setFormData({ ...formData, eindDatum: e.target.value })}
                                                        className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent"
                                                    />
                                                </div>
                                            </div>
                                            <div>
                                                <label className="block text-sm font-medium text-gray-700 mb-1">Notities</label>
                                                <textarea
                                                    value={formData.notities || ''}
                                                    onChange={(e) => setFormData({ ...formData, notities: e.target.value })}
                                                    rows="3"
                                                    className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent"
                                                />
                                            </div>
                                        </div>
                                    )}

                                    {modalType === 'budget' && (
                                        <div className="space-y-4">
                                            <div>
                                                <label className="block text-sm font-medium text-gray-700 mb-1">Categorie *</label>
                                                <input
                                                    type="text"
                                                    required
                                                    value={formData.categorie || ''}
                                                    onChange={(e) => setFormData({ ...formData, categorie: e.target.value })}
                                                    className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent"
                                                />
                                            </div>
                                            <div>
                                                <label className="block text-sm font-medium text-gray-700 mb-1">Gepland budget (â‚¬) *</label>
                                                <input
                                                    type="number"
                                                    required
                                                    step="0.01"
                                                    value={formData.gepland || ''}
                                                    onChange={(e) => setFormData({ ...formData, gepland: parseFloat(e.target.value) })}
                                                    className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent"
                                                />
                                            </div>
                                            <div>
                                                <label className="block text-sm font-medium text-gray-700 mb-1">Notities</label>
                                                <textarea
                                                    value={formData.notities || ''}
                                                    onChange={(e) => setFormData({ ...formData, notities: e.target.value })}
                                                    rows="3"
                                                    className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent"
                                                />
                                            </div>
                                            <div className="bg-blue-50 border border-blue-200 rounded-lg p-4">
                                                <p className="text-sm text-blue-800">
                                                    <strong>Let op:</strong> De uitgaven worden automatisch berekend op basis van gekochte producten en geaccepteerde offertes die aan deze categorie gekoppeld zijn.
                                                </p>
                                            </div>
                                        </div>
                                    )}

                                    <div className="flex items-center gap-3 mt-6 pt-4 border-t border-gray-200">
                                        <button
                                            type="submit"
                                            className="flex-1 bg-indigo-600 text-white px-6 py-2 rounded-lg hover:bg-indigo-700 transition font-medium"
                                        >
                                            {editItem ? 'Opslaan' : 'Toevoegen'}
                                        </button>
                                        <button
                                            type="button"
                                            onClick={closeModal}
                                            className="flex-1 bg-gray-200 text-gray-800 px-6 py-2 rounded-lg hover:bg-gray-300 transition font-medium"
                                        >
                                            Annuleren
                                        </button>
                                    </div>
                                </form>
                                )}
                            </div>
                        </div>
                    )}
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<VerbouwingPlanner />);
    </script>
</body>
</html>